import{a as e}from"./chunk-GQSCBKA6.js";import{randomUUID as u}from"crypto";var r=class{constructor(t,s,i){e(this,"monitoring");e(this,"sessionId");e(this,"seqId");e(this,"input");e(this,"output");e(this,"metadata");e(this,"metrics");e(this,"status");e(this,"errorMessage");e(this,"startTs");this.monitoring=t,this.sessionId=s,this.seqId=i,this.metrics={}}setInput(t){this.input=t}setOutput(t){this.output=t}setMetadata(t){this.metadata=t}_start(t,s){this.input=t,this.metadata=s,this.startTs=Date.now(),this.status="STARTED"}_end(t=!1,s){this._hasEnded()||(this.metrics.durationMs=Date.now()-this.startTs,this.status=t?"FAILED":"COMPLETED",this.errorMessage=s,this.monitoring._endItem(this._toTrace()))}_hasEnded(){return["COMPLETED","FAILED"].includes(this.status)}_toTrace(){return{sessionId:this.sessionId,seqId:this.seqId,parentSeqId:void 0,event:{kind:"monitoring",input:this.input,output:this.output,metadata:this.metadata,metrics:this.metrics,status:this.status,errorMessage:this.errorMessage}}}},o=class{constructor(t){e(this,"client");e(this,"session");e(this,"currentItem");this.client=t}start(){this.session||(this.session={id:u(),seq_id:0}),this.client.tracing._setMode("monitoring")}stop(){this.session=void 0,this.client.tracing._setMode("off")}startItem(t,s){let[i,d]=this._nextSeqId(),n=new r(this,i,d);return n._start(t,s),this.currentItem=n,n}_endItem(t){this.currentItem=void 0,this.client.tracing._logLiveTrace(t)}_getTraceContext(){if(!this.session)throw Error("Monitoring not started");let t=this.currentItem,[s,i]=this._nextSeqId();return{sessionId:s,seqId:i,parentSeqId:t?.seqId}}_nextSeqId(){if(!this.session)throw Error("Monitoring not started");return this.session.seq_id+=1,[this.session.id,this.session.seq_id]}};export{r as a,o as b};
//# sourceMappingURL=chunk-ULXN5EBY.js.map