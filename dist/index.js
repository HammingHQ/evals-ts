import{a as f}from"./chunk-LBDEHSKQ.js";import"./chunk-TZ55H3QO.js";import{a as x}from"./chunk-3QRTNJLL.js";import{a as o}from"./chunk-GQSCBKA6.js";var T=(s=>(s.CREATED="CREATED",s.RUNNING="RUNNING",s.SCORING="SCORING",s.SCORING_FAILED="SCORING_FAILED",s.FINISHED="FINISHED",s.FAILED="FAILED",s))(T||{}),l=class{constructor(t){o(this,"client");this.client=t}async start(t,e){let r=(await(await this.client.fetch(`/experiments/${t.id}/items`,{method:"POST",body:JSON.stringify({datasetItemId:e.id,output:{},metrics:{}})})).json()).item,s=Date.now();return{item:r,startTs:s}}async end(t,e){let{item:a,startTs:n}=t,r=Date.now()-n;await this.client.tracing._flush(a.id),await this.client.fetch(`/experiments/${a.experimentId}/items/${a.id}`,{method:"PATCH",body:JSON.stringify({output:e,metrics:{durationMs:r}})})}},u=class{constructor(t){o(this,"client");o(this,"items");this.client=t,this.items=new l(this.client)}async run(t,e){let{dataset:a}=t,n=await this.client.datasets.load(a),{name:r=this.generateName(n.name),scoring:s=N,metadata:I={}}=t,i=await this.start(r,a,s,I),y=`${new URL(this.client.baseURL).origin}/experiments/${i.id}`;try{if(t.parallel){let c=async p=>{let D=await this.items.start(i,p),E=await e(p.input);await this.items.end(D,E)},d=typeof t.parallel=="number"?t.parallel:void 0;await x(n.items,c,d)}else for(let c of n.items){let d=await this.items.start(i,c),p=await e(c.input);await this.items.end(d,p)}}catch(c){throw await this.end(i,"FAILED"),c}finally{await this.end(i),console.log("See experiment results at:",y)}return{experimentUrl:y}}async start(t,e,a,n){return(await(await this.client.fetch("/experiments",{method:"POST",body:JSON.stringify({name:t,dataset:e,status:"RUNNING",scoring:a,metadata:n})})).json()).experiment}async end(t,e="FINISHED"){await this.client.fetch(`/experiments/${t.id}`,{method:"PATCH",body:JSON.stringify({status:e})})}generateName(t){return`Experiment for ${t} - ${new Date().toLocaleString()}`}},R=(i=>(i.AccuracyAI="accuracy_ai",i.FactsCompare="facts_compare",i.ContextRecall="context_recall",i.ContextPrecision="context_precision",i.Hallucination="hallucination",i.StringDiff="string_diff",i.Refusal="refusal",i.SqlAst="sql_ast",i))(R||{}),N=["string_diff"],g=class{constructor(t){o(this,"client");this.client=t}async load(t){let e=await this.client.fetch(`/datasets/${t}`,{method:"GET"}),a;try{a=await e.json()}catch(n){throw new Error(`Failed to parse dataset response as JSON for dataset ID: ${t}: ${n}`)}return a.dataset}async list(){return(await(await this.client.fetch("/datasets")).json()).datasets}async create(t){let{name:e,description:a,items:n}=t;return(await(await this.client.fetch("/datasets",{method:"POST",body:JSON.stringify({name:e,description:a,items:n})})).json()).dataset}},h=class{constructor(t){o(this,"client");o(this,"collected",[]);o(this,"currentLocalTraceId",0);this.client=t}nextTraceId(){return this.currentLocalTraceId++}async _flush(t){let e=this.collected;this.collected=[];let a={id:this.nextTraceId(),experimentItemId:t,event:{kind:"root"}},n=[a];for(let r of e)n.push({id:this.nextTraceId(),experimentItemId:t,parentId:a.id,event:r});await this.client.fetch("/traces",{method:"POST",body:JSON.stringify({traces:n})})}_generationEvent(t){return{kind:"llm",...t}}_retrievalEvent(t){let e=s=>typeof s=="string",a=t.results?.every(e),n=s=>typeof s=="string"?{pageContent:s,metadata:{}}:s,r=a?t.results?.map(n):t.results;return{kind:"vector",...t,results:r}}log(t,e){typeof t=="string"?this.collected.push({[t]:e}):this.collected.push(t)}logGeneration(t){this.log(this._generationEvent(t))}logRetrieval(t){this.log(this._retrievalEvent(t))}},v=["apiKey","baseURL"],w=class extends f{constructor(e){let a=Object.keys(e).filter(n=>!v.includes(n));a.length>0&&console.warn(`WARNING: Unexpected config keys found: ${a.join(", ")}. Valid config keys are: ${v.join(", ")}. The unexpected keys will be ignored.`);super({apiKey:e.apiKey,baseURL:e.baseURL??"https://app.hamming.ai/api/rest"});o(this,"experiments",new u(this));o(this,"datasets",new g(this));o(this,"tracing",new h(this))}};export{N as DefaultScoreTypes,T as ExperimentStatus,w as Hamming,R as ScoreType};
//# sourceMappingURL=index.js.map