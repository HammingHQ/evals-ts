var v=Object.defineProperty;var E=(o,t,e)=>t in o?v(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var r=(o,t,e)=>(E(o,typeof t!="symbol"?t+"":t,e),e);var w=(s=>(s.CREATED="CREATED",s.RUNNING="RUNNING",s.SCORING="SCORING",s.SCORING_FAILED="SCORING_FAILED",s.FINISHED="FINISHED",s.FAILED="FAILED",s))(w||{}),y=["apiKey","baseURL"],d=class{constructor(t){r(this,"client");this.client=t}async start(t,e){let i=(await(await this.client.fetch(`/experiments/${t.id}/items`,{method:"POST",body:JSON.stringify({datasetItemId:e.id,output:{},metrics:{}})})).json()).item,s=Date.now();return{item:i,startTs:s}}async end(t,e){let{item:n,startTs:a}=t,i=Date.now()-a;await this.client.fetch(`/experiments/${n.experimentId}/items/${n.id}`,{method:"PATCH",body:JSON.stringify({output:e,metrics:{durationMs:i}})}),await this.client.tracing._flush(n.id)}},u=class{constructor(t){r(this,"client");r(this,"items");this.client=t,this.items=new d(this.client)}async run(t,e){let{dataset:n}=t,a=await this.client.datasets.load(n),{name:i=this.generateName(a.name),scoring:s=D,metadata:c={}}=t,m=await this.start(i,n,s,c);try{for(let p of a.items){let I=await this.items.start(m,p),x=await e(p.input);await this.items.end(I,x)}}catch(p){throw await this.end(m,"FAILED"),p}finally{await this.end(m)}}async start(t,e,n,a){return(await(await this.client.fetch("/experiments",{method:"POST",body:JSON.stringify({name:t,dataset:e,status:"RUNNING",scoring:n,metadata:a})})).json()).experiment}async end(t,e="FINISHED"){await this.client.fetch(`/experiments/${t.id}`,{method:"PATCH",body:JSON.stringify({status:e})})}generateName(t){return`Experiment for ${t} - ${new Date().toLocaleString()}`}},R=(c=>(c.AccuracyAI="accuracy_ai",c.AccuracyHuman="accuracy_human",c.FactsCompare="facts_compare",c.ContextRecall="context_recall",c.ContextPrecision="context_precision",c.Hallucination="hallucination",c.StringDiff="string_diff",c))(R||{}),D=["string_diff"],l=class{constructor(t){r(this,"client");this.client=t}async load(t){return(await(await this.client.fetch(`/datasets/${t}`)).json()).dataset}async list(){return(await(await this.client.fetch("/datasets")).json()).datasets}async create(t){let{name:e,description:n,items:a}=t;return(await(await this.client.fetch("/datasets",{method:"POST",body:JSON.stringify({name:e,description:n,items:a})})).json()).dataset}},h=class{constructor(t){r(this,"apiKey");r(this,"baseURL");this.apiKey=t.apiKey,this.baseURL=this.sanitize_base_url(t.baseURL)}sanitize_base_url(t){return t=t.trim(),t.endsWith("/")?t.slice(0,-1):t}async fetch(t,e){let n=this.baseURL+t,a=await fetch(n,{...e,headers:{...e?.headers,authorization:`Bearer ${this.apiKey}`,"content-type":"application/json"}});return a.ok||this.handleErrorResponse(a,n),a}async handleErrorResponse(t,e){let n=t.status,a=t.statusText,i=`Request failed with status ${n} ${a} while accessing ${e}.`;throw n===401?i=`UNAUTHORIZED: Invalid API key ending in '${this.apiKey.slice(-4)}'. Visit https://app.hamming.ai/settings to see valid API keys.`:n===403?i=`FORBIDDEN: You do not have permission to access ${e}.`:n===404?i=`NOT FOUND: The requested resource at ${e} could not be found.`:n>=500&&(i=`SERVER ERROR: There was a problem with the server while accessing ${e}. If the issue persists, feel free to email us at founders@hamming.ai for help.`),new Error(i)}},g=class{constructor(t){r(this,"client");r(this,"collected",[]);r(this,"currentLocalTraceId",0);this.client=t}nextTraceId(){return this.currentLocalTraceId++}async _flush(t){let e=this.collected;this.collected=[];let n={id:this.nextTraceId(),experimentItemId:t,event:{kind:"root"}},a=[n];for(let i of e)a.push({id:this.nextTraceId(),experimentItemId:t,parentId:n.id,event:i});await this.client.fetch("/traces",{method:"POST",body:JSON.stringify({traces:a})})}_generationEvent(t){return{kind:"llm",...t}}_retrievalEvent(t){let e=s=>typeof s=="string",n=t.results?.every(e),a=s=>typeof s=="string"?{pageContent:s,metadata:{}}:s,i=n?t.results?.map(a):t.results;return{kind:"vector",...t,results:i}}log(t,e){typeof t=="string"?this.collected.push({[t]:e}):this.collected.push(t)}logGeneration(t){this.log(this._generationEvent(t))}logRetrieval(t){this.log(this._retrievalEvent(t))}},f=class extends h{constructor(e){let n=Object.keys(e).filter(a=>!y.includes(a));n.length>0&&console.warn(`WARNING: Unexpected config keys found: ${n.join(", ")}. Valid config keys are: ${y.join(", ")}. The unexpected keys will be ignored.`);super({apiKey:e.apiKey,baseURL:e.baseURL??"https://app.hamming.ai/api/rest"});r(this,"experiments",new u(this));r(this,"datasets",new l(this));r(this,"tracing",new g(this))}};export{D as DefaultScoreTypes,w as ExperimentStatus,f as Hamming,R as ScoreType};
//# sourceMappingURL=index.js.map