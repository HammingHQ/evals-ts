"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var x=Object.defineProperty;var g=(i,t,e)=>t in i?x(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(g(i,typeof t!="symbol"?t+"":t,e),e);var f=(n=>(n.CREATED="CREATED",n.RUNNING="RUNNING",n.SCORING="SCORING",n.SCORING_FAILED="SCORING_FAILED",n.FINISHED="FINISHED",n.FAILED="FAILED",n))(f||{}),m=class{constructor(t){r(this,"client");this.client=t}start(t,e){let a=Date.now();return{experiment:t,item:{datasetItemId:e.id,output:{response:""},metrics:{durationMs:0}},startTs:a}}async end(t,e){let a=Date.now()-t.startTs;t.item.metrics.durationMs=a,t.item.output=e,await this.client.fetch(`/experiments/${t.experiment.id}/items`,{method:"POST",body:JSON.stringify(t.item)})}},u=class{constructor(t){r(this,"client");r(this,"items");this.client=t,this.items=new m(this.client)}async run(t,e){let{dataset:a}=t,o=await this.client.datasets.load(a),{name:p=this.generateName(o.name),score:n=E}=t,s=await this.start(p,a,n);try{for(let c of o.items){let h=this.items.start(s,c),l=await e(c.input);await this.items.end(h,l)}}catch(c){throw await this.end(s,"FAILED"),c}finally{await this.end(s)}}async start(t,e,a){return(await(await this.client.fetch("/experiments",{method:"POST",body:JSON.stringify({name:t,dataset:e,status:"RUNNING",score:a})})).json()).experiment}async end(t,e="FINISHED"){await this.client.fetch(`/experiments/${t.id}`,{method:"PATCH",body:JSON.stringify({status:e})})}generateName(t){return`Experiment for ${t} - ${new Date().toLocaleString()}`}},D= exports.ScoreType =(s=>(s.accuracy_ai="accuracy_ai",s.accuracy_human="accuracy_human",s.facts_compare="facts_compare",s.context_recall="context_recall",s.context_precision="context_precision",s.hallucination="hallucination",s.string_diff="string_diff",s))(D||{}),E= exports.DefaultScoreTypes =["string_diff"],d=class{constructor(t){r(this,"client");this.client=t}async load(t){return(await(await this.client.fetch(`/datasets/${t}`)).json()).dataset}async create(t){let{name:e,description:a,items:o}=t;return(await(await this.client.fetch("/datasets",{method:"POST",body:JSON.stringify({name:e,description:a,items:o})})).json()).dataset}};var y=class{constructor(t){r(this,"apiKey");r(this,"baseURL");this.apiKey=t.apiKey,this.baseURL=this.sanitize_base_url(t.baseURL)}sanitize_base_url(t){return t=t.trim(),t.endsWith("/")?t.slice(0,-1):t}fetch(t,e){return fetch(this.baseURL+t,{...e,headers:{..._optionalChain([e, 'optionalAccess', _ => _.headers]),authorization:`Bearer ${this.apiKey}`,"content-type":"application/json"}})}},I= exports.Hamming =class extends y{constructor(e){super({apiKey:e.apiKey,baseURL:e.baseURL});r(this,"experiments",new u(this));r(this,"datasets",new d(this))}};exports.DefaultScoreTypes = E; exports.ExperimentStatus = f; exports.Hamming = I; exports.ScoreType = D;
//# sourceMappingURL=index.cjs.map