"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunkQBLTVT5Qcjs = require('./chunk-QBLTVT5Q.cjs');var _chunkZ6K3IXPNcjs = require('./chunk-Z6K3IXPN.cjs');var _chunk7ARU3YXQcjs = require('./chunk-7ARU3YXQ.cjs');var d=class{constructor(t){_chunk7ARU3YXQcjs.a.call(void 0, this,"client");this.client=t}async start(t,e){let n=(await(await this.client.fetch(`/experiments/${t.id}/items`,{method:"POST",body:JSON.stringify({datasetItemId:e.id,output:{},metrics:{}})})).json()).item,o=Date.now();return{item:n,startTs:o}}async end(t,e){let{item:a,startTs:i}=t,n=Date.now()-i;await this.client.tracing._flush(a.id),await this.client.fetch(`/experiments/${a.experimentId}/items/${a.id}`,{method:"PATCH",body:JSON.stringify({output:e,metrics:{durationMs:n}})})}},w= exports.a =class{constructor(t){_chunk7ARU3YXQcjs.a.call(void 0, this,"client");_chunk7ARU3YXQcjs.a.call(void 0, this,"items");this.client=t,this.items=new d(this.client)}async run(t,e){this.client.tracing._setMode("experiment");let{dataset:a}=t,i=await this.client.datasets.load(a),{name:n=this.generateName(i.name),scoring:o=_chunkZ6K3IXPNcjs.b,metadata:l={}}=t,r=await this.start(n,a,o,l),u=`${new URL(this.client.baseURL).origin}/experiments/${r.id}`;try{if(t.parallel){let s=async m=>{let f=await this.items.start(r,m),g=await e(m.input);await this.items.end(f,g)},p=typeof t.parallel=="number"?t.parallel:void 0;await _chunkQBLTVT5Qcjs.a.call(void 0, i.items,s,p)}else for(let s of i.items){let p=await this.items.start(r,s),m=await e(s.input);await this.items.end(p,m)}}catch(s){throw await this.end(r,"FAILED"),s}finally{await this.end(r),console.log("See experiment results at:",u)}return{experimentUrl:u}}async start(t,e,a,i){let n="RUNNING";return(await(await this.client.fetch("/experiments",{method:"POST",body:JSON.stringify({name:t,dataset:e,status:n,scoring:a,metadata:i})})).json()).experiment}async end(t,e="FINISHED"){await this.client.fetch(`/experiments/${t.id}`,{method:"PATCH",body:JSON.stringify({status:e})})}generateName(t){return`Experiment for ${t} - ${new Date().toLocaleString()}`}};exports.a = w;
//# sourceMappingURL=chunk-PBI6K26G.cjs.map