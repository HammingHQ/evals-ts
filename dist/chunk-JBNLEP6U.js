import{a as i}from"./chunk-4DTMREEV.js";import{a as t}from"./chunk-GQSCBKA6.js";var o=512,a=class{constructor(e){t(this,"client");t(this,"queue",[]);t(this,"stopped",!1);t(this,"queueHasMessages",new i);this.client=e}log(e){this.queue.push(e),this.queueHasMessages.set()}async start(){for(console.log("Starting logger thread..");!this.stopped;)await this.queueHasMessages.wait(),await this._processQueue();await this._processQueue(),console.log("Logger thread exited!")}stop(){console.log("Waiting for logger thread to exit.."),this.stopped=!0}_drainQueue(){let e=Math.min(this.queue.length,o);return this.queue.splice(0,e)}async _processQueue(){let e=this._drainQueue();await this._publish(e),this.queue.length===0&&this.queueHasMessages.reset()}async _publish(e){if(e.length!==0){process.env.NODE_ENV==="development"&&console.log(`Publishing ${e.length} message(s)..`);try{await this.client.fetch("/logs",{method:"POST",body:JSON.stringify({logs:e.map(s=>({...s,payload:{...s.payload,session_id:s.payload?.session_id,seq_id:s.payload?.seq_id,parent_seq_id:s.payload?.parent_seq_id}}))})}),process.env.NODE_ENV==="development"&&console.log(`Published ${e.length} messages!`)}catch(s){console.error(`Failed to publish messages: ${s}`)}}}};export{a};
//# sourceMappingURL=chunk-JBNLEP6U.js.map