import{a as i}from"./chunk-4DTMREEV.js";import{a as s}from"./chunk-GQSCBKA6.js";var a=512,o=class{constructor(e){s(this,"client");s(this,"queue",[]);s(this,"stopped",!1);s(this,"queueHasMessages",new i);this.client=e}log(e){this.queue.push(e),this.queueHasMessages.set()}async start(){for(console.log("Starting logger thread..");!this.stopped;)await this.queueHasMessages.wait(),await this._processQueue();await this._processQueue(),console.log("Logger thread exited!")}stop(){console.log("Waiting for logger thread to exit.."),this.stopped=!0}_drainQueue(){let e=Math.min(this.queue.length,a);return this.queue.splice(0,e)}async _processQueue(){let e=this._drainQueue();await this._publish(e),this.queue.length===0&&this.queueHasMessages.reset()}async _publish(e){if(e.length!==0){process.env.NODE_ENV==="development"&&console.log(`Publishing ${e.length} message(s)..`);try{await this.client.fetch("/logs",{method:"POST",body:JSON.stringify({logs:e})}),process.env.NODE_ENV==="development"&&console.log(`Published ${e.length} messages!`)}catch(t){console.error(`Failed to publish messages: ${t}`)}}}};export{o as a};
//# sourceMappingURL=chunk-ULJ4FETH.js.map