import{a as i}from"./chunk-2TYLN5HE.js";import{a as s}from"./chunk-GQSCBKA6.js";var a=512,o=class{constructor(e){s(this,"client");s(this,"queue");s(this,"stopEvent");s(this,"queueNotEmptyEvent");this.client=e,this.queue=[],this.queue=[],this.stopEvent=!1,this.queueNotEmptyEvent=new i}log(e){this.queue.push(e),this.queueNotEmptyEvent.set()}async start(){for(;!this.stopEvent;)await this.queueNotEmptyEvent.wait(),this.stopEvent||await this._process_queue()}stop(){console.log("Waiting for logger thread to exit.."),this.stopEvent=!0}_drain_queue(){let e=[];for(;this.queue.length>0&&e.length<a;){let t=this.queue.shift();t!==void 0&&e.push(t)}return e}async _process_queue(){let e=this._drain_queue();await this._publish(e),this.queue.length>0?this.queueNotEmptyEvent.set():this.queueNotEmptyEvent.reset()}async _publish(e){console.log(`Publishing ${e.length} messages..`),console.log(`Messages: ${JSON.stringify(e)}`);try{await this.client.fetch("/logs",{method:"POST",body:JSON.stringify({logs:e.map(t=>({...t,payload:{...t.payload,session_id:t.payload?.sessionId,seq_id:t.payload?.seqId,parent_seq_id:t.payload?.parentSeqId}}))})}),console.log(`Published ${e.length} messages!`)}catch(t){console.error(`Failed to publish messages: ${t}`)}}};export{o as a};
//# sourceMappingURL=chunk-N6UUDW67.js.map